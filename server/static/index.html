<!DOCTYPE html>
<html data-color-mode="dark" data-dark-theme="dark">

<head>
  <title>Action Terminal</title>
  <link rel="stylesheet" href="https://unpkg.com/@primer/css@22.0.2/dist/primer.css">
  <link rel="stylesheet" href="/styles.css">
</head>

<body class="color-bg-default">
  <!-- SSE Connection Indicator -->
  <div id="sse-indicator" class="sse-indicator">
    <div class="sse-spinner"></div>
    <span>Connected</span>
  </div>

  <div id="login-view" class="flex-column flex-items-center flex-justify-center"
    style="min-height: 100vh; display: none;">
    <div class="Box color-shadow-large p-5" style="max-width: 360px; width: 90%; border-radius: 12px;">
      <div class="text-center mb-4">
        <svg class="mb-3" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#8b949e" stroke-width="1.5">
          <rect x="2" y="3" width="20" height="14" rx="2" />
          <path d="M8 21h8M12 17v4" />
          <path d="M6 8l3 3-3 3M11 14h4" stroke="#3fb950" />
        </svg>
        <h1 class="h3 mt-2" style="color: #c9d1d9;">Action Terminal</h1>
        <p class="color-fg-muted f5 mt-2">Debug your GitHub Actions runners directly in the browser.</p>
      </div>
      <a href="/auth/github" class="btn btn-primary btn-block" style="border-radius: 6px;">
        <svg class="octicon mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16">
          <path fill="currentColor"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
        Sign in with GitHub
      </a>
    </div>
  </div>

  <div id="app">
    <div class="header-bar">
      <div class="header-logo">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#8b949e" stroke-width="1.5">
          <rect x="2" y="3" width="20" height="14" rx="2" />
          <path d="M8 21h8M12 17v4" />
          <path d="M6 8l3 3-3 3M11 14h4" stroke="#3fb950" />
        </svg>
        <span class="header-title">Action Terminal</span>
      </div>
    </div>
    <div id="status" class="status-banner" style="display:none;"></div>
    <div class="section-header">Active Sessions</div>
    <div id="sessions-list"></div>
  </div>

  <!-- OTP Modal -->
  <div id="otp-modal" class="modal-overlay">
    <div class="Box color-shadow-large anim-fade-in fast" style="max-width: 400px; width: 90%; border-radius: 12px;">
      <div class="Box-header" style="border-radius: 12px 12px 0 0; background: #161b22; border-bottom: 1px solid #30363d; padding: 16px;">
        <h2 class="Box-title" style="font-size: 16px; margin: 0;">Enter verification code</h2>
      </div>
      <div class="Box-body p-4" style="background: #0d1117;">
        <p class="color-fg-muted f6 mb-3">Enter the 6-digit code from your authenticator app.</p>
        <div id="otp-error" class="flash flash-error mb-3" style="display: none; border-radius: 6px;"></div>
        <input type="text" id="otp-input" class="form-control form-control-large input-block otp-input" maxlength="6"
          pattern="[0-9]*" inputmode="numeric" placeholder="000000" autocomplete="one-time-code" 
          style="border-radius: 6px; background: #161b22; border: 1px solid #30363d;">
      </div>
      <div class="Box-footer p-3" style="border-radius: 0 0 12px 12px; background: #161b22; border-top: 1px solid #30363d;">
        <div class="d-flex flex-justify-end gap-2">
          <button class="btn" type="button" onclick="window.cancelOTP()" style="border-radius: 6px;">Cancel</button>
          <button class="btn btn-primary" type="button" id="otp-submit" onclick="window.submitOTP()"
            disabled style="border-radius: 6px;">Connect</button>
        </div>
      </div>
    </div>
  </div>

  <div id="terminal-container">
    <div class="terminal-header">
      <div class="terminal-header-left">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="#8b949e">
          <path d="M0 2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0114.25 15H1.75A1.75 1.75 0 010 13.25Zm1.75-.25a.25.25 0 00-.25.25v10.5c0 .138.112.25.25.25h12.5a.25.25 0 00.25-.25V2.75a.25.25 0 00-.25-.25Zm7.47 3.97a.75.75 0 011.06 0l2 2a.75.75 0 010 1.06l-2 2a.75.75 0 11-1.06-1.06L10.69 9 9.22 7.53a.75.75 0 010-1.06Zm-3.47 0a.75.75 0 010 1.06L4.31 9l1.47 1.47a.75.75 0 11-1.06 1.06l-2-2a.75.75 0 010-1.06l2-2a.75.75 0 011.06 0Z"/>
        </svg>
        <span class="terminal-title" id="terminal-session-name">Terminal</span>
        <span class="terminal-status" id="terminal-status"></span>
      </div>
      <button class="close-btn" onclick="window.closeTerminal()">
        <svg width="12" height="12" viewBox="0 0 16 16" fill="currentColor">
          <path d="M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"/>
        </svg>
        Close
      </button>
    </div>
    <div id="terminal"></div>
  </div>

  <script type="module">
    import { initApp } from '/js/app.js';
    
    // Initialize the application when DOM is ready
    initApp().catch(err => {
      console.error('Failed to initialize app:', err);
    });
  </script>
</body>

</html>